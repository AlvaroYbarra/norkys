import java.util.Arrays;
import java.util.Scanner;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;

public class ProyectoNorkys {
    String[] usuarios = new String[4];
    String[] productos = {"1.-norkys brasa", "2.-norkys burguer", "3.-norkys parrilla", "4.-bebidas"};
    double[] precios = {30.00, 19.00, 35.00, 10.00};
    double igv = 0.18;
    double total, totalDelSubtotal, totalDeIgv;
    double[] totalPagarProductos = new double[productos.length];
    double[] subtotalIgvProductos = new double[productos.length];
    double[] subtotalProductos = new double[productos.length];
    int respuesta, opcion;
    boolean sesionIniciada = false;

    Scanner scanner = new Scanner(System.in);

    public String iniciarSesion() {
        System.out.print("Ingrese correo: ");
        String correo = scanner.nextLine();
        System.out.print("Ingrese su contraseña: ");
        String contrasena = scanner.nextLine();

        if ("ybarra@gmail.com".equals(correo) && "123".equals(contrasena)) {
            sesionIniciada = true;
            this.usuario();
            this.menu();
            return "Inicio de sesión exitoso. ¡Bienvenido a norkys!";
        } else {
            return "Inicio de sesión fallido. Verifique sus credenciales.";
        }
    }

    public void usuario() {
        System.out.print("Por favor, ingrese su nombre: ");
        usuarios[0] = scanner.nextLine();
        System.out.print("Ingrese su apellido: ");
        usuarios[1] = scanner.nextLine();
        System.out.print("Ingrese su número de teléfono: ");
        usuarios[2] = scanner.nextLine();
        System.out.print("Ingrese su DNI: ");
        usuarios[3] = scanner.nextLine();
    }

    public void productos() {
        for (int i = 0; i < productos.length; i++) {
            System.out.println(productos[i] + " ----------> precio:S/." + precios[i]);
        }
        System.out.print("Seleccione la opción: ");
        int opcionProducto = scanner.nextInt();
        System.out.print("Ingrese la cantidad que desea del producto: ");
        int cantidadProducto = scanner.nextInt();
        scanner.nextLine();

        if (opcionProducto >= 1 && opcionProducto <= productos.length) {
            int index = opcionProducto - 1;
            subtotalProductos[index] += cantidadProducto * precios[index];
            subtotalIgvProductos[index] += subtotalProductos[index] * igv;
            totalPagarProductos[index] = subtotalProductos[index] + subtotalIgvProductos[index];

            System.out.println("Eligió " + cantidadProducto + " " + productos[index] + " el total es de: S/." + totalPagarProductos[index]);
            System.out.println("------ELIJA UNA DE LAS SIGUIENTES OPCIONES------");
            System.out.println("Opción 1: Seguir comprando productos");
            System.out.println("Opción 2: Pagar");
            respuesta = scanner.nextInt();
            scanner.nextLine();
            switch (respuesta) {
                case 1:
                    this.productos();
                    break;
                case 2:
                    this.pagoProductos();
                    break;
                default:
                    System.out.println("Opción inválida, regresando al menú principal.");
                    break;
            }
        } else {
            System.out.println("Opción inválida");
            System.out.println("Redirigiendo al menú principal");
        }
    }

    public void pagoProductos() {
        total = Arrays.stream(totalPagarProductos).sum();
        totalDelSubtotal = Arrays.stream(subtotalProductos).sum();
        totalDeIgv = Arrays.stream(subtotalIgvProductos).sum();

        try {
            File archivo = new File("boleta_norkys.txt");
            FileWriter escritor = new FileWriter(archivo);

            escritor.write("----BOLETA DE VENTA---------\n");

            for (int i = 0; i < productos.length; i++) {
                if (subtotalProductos[i] > 0) {
                    escritor.write(productos[i] + " - Cantidad: " + (subtotalProductos[i] / precios[i]) +
                            " - Subtotal: S/." + subtotalProductos[i] + " - IGV: S/." + subtotalIgvProductos[i] +
                            " - Total: S/." + totalPagarProductos[i] + "\n");
                }
            }

            escritor.write(" SUBTOTAL :S/." + totalDelSubtotal + "\n");
            escritor.write(" IGV :S/." + totalDeIgv + "\n");
            escritor.write(" TOTAL :S/." + total + "\n");

            escritor.write("-----------Gracias por su compra! Vuelva pronto.------------\n");

            escritor.close();
            sesionIniciada = false;
            System.out.println("Sesión terminada. Gracias por visitarnos, vuelva pronto.");
        } catch (IOException e) {
            System.out.println("Error al exportar la factura.");
            e.printStackTrace();
        }
    }

    public void menu() {
        if (sesionIniciada) {
            boolean opciones = true;
            while (opciones) {
                System.out.println("Elija una de las siguientes opciones ");
                System.out.println("1.-Productos");
                System.out.println("2.-Atención al cliente");
                System.out.println("3.-Salir");
                System.out.print("Seleccione una opción: ");
                opcion = scanner.nextInt();
                scanner.nextLine();
                switch (opcion) {
                    case 1:
                        this.productos();
                        break;
                    case 2:
                        this.contactar();
                        break;
                    case 3:
                        opciones = false;
                        System.out.println("Gracias por visitarnos, vuelva pronto.");
                        break;
                    default:
                        System.out.println("Ingrese una de las opciones válidas");
                        break;
                }
            }
        }
    }

    public void contactar() {
        System.out.println("---------------Atención al cliente-----------------");
        System.out.println("Hola " + usuarios[0] + ", elija una de las siguientes opciones:");
        System.out.println("1.-Crear cuenta");
        System.out.println("2.-Número para pedidos");
        System.out.println("3.-Quejas");
        int atencionCliente = scanner.nextInt();
        scanner.nextLine();
        switch (atencionCliente) {
            case 1:
                this.crearCuenta();
                break;
            case 2:
                System.out.println("Nuestro número para pedidos es: (01)505-2222");
                System.out.println("Regresando al menú principal");
                this.menu();
                break;
            case 3:
                System.out.println("Realice su queja; eso nos ayudará a mejorar como empresa");
                this.quejas();
                break;
            default:
                System.out.println("Opción inválida, regresando al menú principal.");
                break;
        }
    }

    public void crearCuenta() {
        System.out.println("-----------Crear cuenta-----------");
        System.out.print("Ingrese su nombre: ");
        usuarios[0] = scanner.nextLine();
        System.out.print("Ingrese su apellido: ");
        usuarios[1] = scanner.nextLine();
        System.out.print("Ingrese su número de teléfono: ");
        usuarios[2] = scanner.nextLine();
        System.out.print("Ingrese su DNI: ");
        usuarios[3] = scanner.nextLine();
        System.out.println("-----------Se registró satisfactoriamente-----------");
        System.out.println("Redirigiendo al menú principal");
        this.menu();
    }

    public void quejas() {
        System.out.println("----------------Ingrese su queja--------------");
        String queja = scanner.nextLine();
        System.out.println("-----------Su queja se validó satisfactoriamente--------------");

        try {
            File archivo = new File("queja_norkys.txt");
            FileWriter escritor = new FileWriter(archivo);
            escritor.write("----Queja---------\n");
            escritor.write("Queja:" + queja + "\n");
            escritor.close();
        } catch (IOException e) {
            System.out.println("Error al exportar la queja.");
            e.printStackTrace();
        }
    }

    public static void main(String[] args) {
        System.out.println("¡Bienvenido a norkys!");
        ProyectoNorkys proyectonorkys = new ProyectoNorkys();
        System.out.println(proyectonorkys.iniciarSesion()); 
    }
}

